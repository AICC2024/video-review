{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import axios from\"axios\";// Helper to detect mobile browsers\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const isMobile=/Mobi|Android/i.test(navigator.userAgent);const CommentForm=_ref=>{let{videoId}=_ref;const[comment,setComment]=useState(\"\");const[liveTranscript,setLiveTranscript]=useState(\"\");const[pausedTime,setPausedTime]=useState(\"0.00\");const[isRecording,setIsRecording]=useState(false);useEffect(()=>{const video=document.getElementById(\"review-video\");if(video){const handlePause=()=>{setPausedTime(Math.floor(video.currentTime).toString().padStart(2,\"0\"));};video.addEventListener(\"pause\",handlePause);return()=>video.removeEventListener(\"pause\",handlePause);}},[]);const handleSubmit=async()=>{const video=document.getElementById(\"review-video\");let timestamp=\"00\";if(video&&!isNaN(video.currentTime)&&video.readyState>=2){timestamp=Math.floor(video.currentTime).toString().padStart(2,\"0\");}else{console.warn(\"Video not ready. Falling back to 00.\");}try{const token=localStorage.getItem(\"token\");await axios.post(\"/comments\",{video_id:videoId,timestamp,comment},{headers:{Authorization:token}});setComment(\"\");// Dispatch a custom event to notify comment list to refresh\nwindow.dispatchEvent(new Event(\"comments-updated\"));}catch(err){console.error(\"Failed to submit comment:\",err);}};// Web Speech API voice input (desktop only)\nconst startVoiceInput=()=>{const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;if(!SpeechRecognition){alert(\"Voice input is not supported in this browser.\");return;}setIsRecording(true);const recognition=new SpeechRecognition();recognition.lang=\"en-US\";recognition.interimResults=true;recognition.maxAlternatives=1;recognition.onresult=event=>{let transcript=\"\";for(let i=event.resultIndex;i<event.results.length;i++){transcript+=event.results[i][0].transcript;}if(event.results[event.results.length-1].isFinal){setComment(prev=>(prev+\" \"+transcript).trim());setLiveTranscript(\"\");}else{setLiveTranscript(transcript);}};recognition.onerror=event=>{console.error(\"Speech recognition error:\",event.error);setIsRecording(false);};recognition.onend=()=>setIsRecording(false);recognition.start();};return/*#__PURE__*/_jsx(\"div\",{style:{background:\"#f9f9f9\",padding:\"1rem\",borderRadius:\"8px\",boxShadow:\"0 1px 4px rgba(0,0,0,0.1)\",marginBottom:\"1rem\"},children:/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",alignItems:\"flex-end\",gap:\"0.5rem\"},children:[/*#__PURE__*/_jsx(\"textarea\",{value:comment+(isRecording?\" \"+liveTranscript:\"\"),onChange:e=>setComment(e.target.value),placeholder:\"Enter your comment...\",rows:\"4\",cols:\"60\",style:{borderRadius:\"6px\",border:\"1px solid #ccc\",padding:\"0.5rem\",fontSize:\"1rem\",resize:\"vertical\",minHeight:\"60px\"}}),!isMobile&&/*#__PURE__*/_jsx(\"button\",{onClick:startVoiceInput,style:{width:\"44px\",height:\"44px\",background:\"transparent\",border:\"none\",cursor:\"pointer\",display:\"flex\",alignItems:\"center\",justifyContent:\"center\"},\"aria-label\":\"Speak\",title:\"Speak\",children:/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",width:\"28\",height:\"28\",fill:isRecording?\"#e53935\":\"#333\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M12 15c1.66 0 3-1.34 3-3V6c0-1.66-1.34-3-3-3S9 4.34 9 6v6c0 1.66 1.34 3 3 3zm4.3-3c0 2.53-1.84 4.43-4.3 4.9V21h3v2h-8v-2h3v-4.1c-2.46-.47-4.3-2.37-4.3-4.9H4c0 3.53 2.61 6.43 6 6.92V21h4v-2.08c3.39-.49 6-3.39 6-6.92h-2.7z\"})})}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSubmit,disabled:!videoId,style:{backgroundColor:\"#1976d2\",color:\"white\",border:\"none\",borderRadius:\"4px\",padding:\"0.4rem 0.75rem\",fontSize:\"0.95rem\",cursor:\"pointer\"},children:\"Add Comment\"})]})});};export default CommentForm;","map":{"version":3,"names":["React","useState","useEffect","axios","jsx","_jsx","jsxs","_jsxs","isMobile","test","navigator","userAgent","CommentForm","_ref","videoId","comment","setComment","liveTranscript","setLiveTranscript","pausedTime","setPausedTime","isRecording","setIsRecording","video","document","getElementById","handlePause","Math","floor","currentTime","toString","padStart","addEventListener","removeEventListener","handleSubmit","timestamp","isNaN","readyState","console","warn","token","localStorage","getItem","post","video_id","headers","Authorization","window","dispatchEvent","Event","err","error","startVoiceInput","SpeechRecognition","webkitSpeechRecognition","alert","recognition","lang","interimResults","maxAlternatives","onresult","event","transcript","i","resultIndex","results","length","isFinal","prev","trim","onerror","onend","start","style","background","padding","borderRadius","boxShadow","marginBottom","children","display","alignItems","gap","value","onChange","e","target","placeholder","rows","cols","border","fontSize","resize","minHeight","onClick","width","height","cursor","justifyContent","title","xmlns","fill","viewBox","d","disabled","backgroundColor","color"],"sources":["/Users/paulminton/development/video-review/video_review_backend/video_review_frontend/src/components/CommentForm.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport axios from \"axios\";\n\n// Helper to detect mobile browsers\nconst isMobile = /Mobi|Android/i.test(navigator.userAgent);\n\nconst CommentForm = ({ videoId }) => {\n  const [comment, setComment] = useState(\"\");\n  const [liveTranscript, setLiveTranscript] = useState(\"\");\n  const [pausedTime, setPausedTime] = useState(\"0.00\");\n  const [isRecording, setIsRecording] = useState(false);\n\n  useEffect(() => {\n    const video = document.getElementById(\"review-video\");\n    if (video) {\n      const handlePause = () => {\n        setPausedTime(Math.floor(video.currentTime).toString().padStart(2, \"0\"));\n      };\n      video.addEventListener(\"pause\", handlePause);\n      return () => video.removeEventListener(\"pause\", handlePause);\n    }\n  }, []);\n\n  const handleSubmit = async () => {\n    const video = document.getElementById(\"review-video\");\n    let timestamp = \"00\";\n    if (video && !isNaN(video.currentTime) && video.readyState >= 2) {\n      timestamp = Math.floor(video.currentTime).toString().padStart(2, \"0\");\n    } else {\n      console.warn(\"Video not ready. Falling back to 00.\");\n    }\n\n    try {\n      const token = localStorage.getItem(\"token\");\n      await axios.post(\n        \"/comments\",\n        {\n          video_id: videoId,\n          timestamp,\n          comment\n        },\n        {\n          headers: {\n            Authorization: token\n          }\n        }\n      );\n\n      setComment(\"\");\n\n      // Dispatch a custom event to notify comment list to refresh\n      window.dispatchEvent(new Event(\"comments-updated\"));\n    } catch (err) {\n      console.error(\"Failed to submit comment:\", err);\n    }\n  };\n\n  // Web Speech API voice input (desktop only)\n  const startVoiceInput = () => {\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n    if (!SpeechRecognition) {\n      alert(\"Voice input is not supported in this browser.\");\n      return;\n    }\n\n    setIsRecording(true);\n\n    const recognition = new SpeechRecognition();\n    recognition.lang = \"en-US\";\n    recognition.interimResults = true;\n    recognition.maxAlternatives = 1;\n\n    recognition.onresult = (event) => {\n      let transcript = \"\";\n      for (let i = event.resultIndex; i < event.results.length; i++) {\n        transcript += event.results[i][0].transcript;\n      }\n\n      if (event.results[event.results.length - 1].isFinal) {\n        setComment((prev) => (prev + \" \" + transcript).trim());\n        setLiveTranscript(\"\");\n      } else {\n        setLiveTranscript(transcript);\n      }\n    };\n\n    recognition.onerror = (event) => {\n      console.error(\"Speech recognition error:\", event.error);\n      setIsRecording(false);\n    };\n\n    recognition.onend = () => setIsRecording(false);\n\n    recognition.start();\n  };\n\n  return (\n    <div\n      style={{\n        background: \"#f9f9f9\",\n        padding: \"1rem\",\n        borderRadius: \"8px\",\n        boxShadow: \"0 1px 4px rgba(0,0,0,0.1)\",\n        marginBottom: \"1rem\"\n      }}\n    >\n      <div style={{ display: \"flex\", alignItems: \"flex-end\", gap: \"0.5rem\" }}>\n        <textarea\n          value={comment + (isRecording ? \" \" + liveTranscript : \"\")}\n          onChange={(e) => setComment(e.target.value)}\n          placeholder=\"Enter your comment...\"\n          rows=\"4\"\n          cols=\"60\"\n          style={{\n            borderRadius: \"6px\",\n            border: \"1px solid #ccc\",\n            padding: \"0.5rem\",\n            fontSize: \"1rem\",\n            resize: \"vertical\",\n            minHeight: \"60px\"\n          }}\n        />\n        {!isMobile && (\n          <button\n            onClick={startVoiceInput}\n            style={{\n              width: \"44px\",\n              height: \"44px\",\n              background: \"transparent\",\n              border: \"none\",\n              cursor: \"pointer\",\n              display: \"flex\",\n              alignItems: \"center\",\n              justifyContent: \"center\"\n            }}\n            aria-label=\"Speak\"\n            title=\"Speak\"\n          >\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"28\" height=\"28\" fill={isRecording ? \"#e53935\" : \"#333\"} viewBox=\"0 0 24 24\">\n              <path d=\"M12 15c1.66 0 3-1.34 3-3V6c0-1.66-1.34-3-3-3S9 4.34 9 6v6c0 1.66 1.34 3 3 3zm4.3-3c0 2.53-1.84 4.43-4.3 4.9V21h3v2h-8v-2h3v-4.1c-2.46-.47-4.3-2.37-4.3-4.9H4c0 3.53 2.61 6.43 6 6.92V21h4v-2.08c3.39-.49 6-3.39 6-6.92h-2.7z\"/>\n            </svg>\n          </button>\n        )}\n        <button\n          onClick={handleSubmit}\n          disabled={!videoId}\n          style={{\n            backgroundColor: \"#1976d2\",\n            color: \"white\",\n            border: \"none\",\n            borderRadius: \"4px\",\n            padding: \"0.4rem 0.75rem\",\n            fontSize: \"0.95rem\",\n            cursor: \"pointer\"\n          }}\n        >\n          Add Comment\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default CommentForm;\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAClD,MAAO,CAAAC,KAAK,KAAM,OAAO,CAEzB;AAAA,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBACA,KAAM,CAAAC,QAAQ,CAAG,eAAe,CAACC,IAAI,CAACC,SAAS,CAACC,SAAS,CAAC,CAE1D,KAAM,CAAAC,WAAW,CAAGC,IAAA,EAAiB,IAAhB,CAAEC,OAAQ,CAAC,CAAAD,IAAA,CAC9B,KAAM,CAACE,OAAO,CAAEC,UAAU,CAAC,CAAGf,QAAQ,CAAC,EAAE,CAAC,CAC1C,KAAM,CAACgB,cAAc,CAAEC,iBAAiB,CAAC,CAAGjB,QAAQ,CAAC,EAAE,CAAC,CACxD,KAAM,CAACkB,UAAU,CAAEC,aAAa,CAAC,CAAGnB,QAAQ,CAAC,MAAM,CAAC,CACpD,KAAM,CAACoB,WAAW,CAAEC,cAAc,CAAC,CAAGrB,QAAQ,CAAC,KAAK,CAAC,CAErDC,SAAS,CAAC,IAAM,CACd,KAAM,CAAAqB,KAAK,CAAGC,QAAQ,CAACC,cAAc,CAAC,cAAc,CAAC,CACrD,GAAIF,KAAK,CAAE,CACT,KAAM,CAAAG,WAAW,CAAGA,CAAA,GAAM,CACxBN,aAAa,CAACO,IAAI,CAACC,KAAK,CAACL,KAAK,CAACM,WAAW,CAAC,CAACC,QAAQ,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,CAAE,GAAG,CAAC,CAAC,CAC1E,CAAC,CACDR,KAAK,CAACS,gBAAgB,CAAC,OAAO,CAAEN,WAAW,CAAC,CAC5C,MAAO,IAAMH,KAAK,CAACU,mBAAmB,CAAC,OAAO,CAAEP,WAAW,CAAC,CAC9D,CACF,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAQ,YAAY,CAAG,KAAAA,CAAA,GAAY,CAC/B,KAAM,CAAAX,KAAK,CAAGC,QAAQ,CAACC,cAAc,CAAC,cAAc,CAAC,CACrD,GAAI,CAAAU,SAAS,CAAG,IAAI,CACpB,GAAIZ,KAAK,EAAI,CAACa,KAAK,CAACb,KAAK,CAACM,WAAW,CAAC,EAAIN,KAAK,CAACc,UAAU,EAAI,CAAC,CAAE,CAC/DF,SAAS,CAAGR,IAAI,CAACC,KAAK,CAACL,KAAK,CAACM,WAAW,CAAC,CAACC,QAAQ,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,CAAE,GAAG,CAAC,CACvE,CAAC,IAAM,CACLO,OAAO,CAACC,IAAI,CAAC,sCAAsC,CAAC,CACtD,CAEA,GAAI,CACF,KAAM,CAAAC,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,KAAM,CAAAvC,KAAK,CAACwC,IAAI,CACd,WAAW,CACX,CACEC,QAAQ,CAAE9B,OAAO,CACjBqB,SAAS,CACTpB,OACF,CAAC,CACD,CACE8B,OAAO,CAAE,CACPC,aAAa,CAAEN,KACjB,CACF,CACF,CAAC,CAEDxB,UAAU,CAAC,EAAE,CAAC,CAEd;AACA+B,MAAM,CAACC,aAAa,CAAC,GAAI,CAAAC,KAAK,CAAC,kBAAkB,CAAC,CAAC,CACrD,CAAE,MAAOC,GAAG,CAAE,CACZZ,OAAO,CAACa,KAAK,CAAC,2BAA2B,CAAED,GAAG,CAAC,CACjD,CACF,CAAC,CAED;AACA,KAAM,CAAAE,eAAe,CAAGA,CAAA,GAAM,CAC5B,KAAM,CAAAC,iBAAiB,CAAGN,MAAM,CAACM,iBAAiB,EAAIN,MAAM,CAACO,uBAAuB,CACpF,GAAI,CAACD,iBAAiB,CAAE,CACtBE,KAAK,CAAC,+CAA+C,CAAC,CACtD,OACF,CAEAjC,cAAc,CAAC,IAAI,CAAC,CAEpB,KAAM,CAAAkC,WAAW,CAAG,GAAI,CAAAH,iBAAiB,CAAC,CAAC,CAC3CG,WAAW,CAACC,IAAI,CAAG,OAAO,CAC1BD,WAAW,CAACE,cAAc,CAAG,IAAI,CACjCF,WAAW,CAACG,eAAe,CAAG,CAAC,CAE/BH,WAAW,CAACI,QAAQ,CAAIC,KAAK,EAAK,CAChC,GAAI,CAAAC,UAAU,CAAG,EAAE,CACnB,IAAK,GAAI,CAAAC,CAAC,CAAGF,KAAK,CAACG,WAAW,CAAED,CAAC,CAAGF,KAAK,CAACI,OAAO,CAACC,MAAM,CAAEH,CAAC,EAAE,CAAE,CAC7DD,UAAU,EAAID,KAAK,CAACI,OAAO,CAACF,CAAC,CAAC,CAAC,CAAC,CAAC,CAACD,UAAU,CAC9C,CAEA,GAAID,KAAK,CAACI,OAAO,CAACJ,KAAK,CAACI,OAAO,CAACC,MAAM,CAAG,CAAC,CAAC,CAACC,OAAO,CAAE,CACnDnD,UAAU,CAAEoD,IAAI,EAAK,CAACA,IAAI,CAAG,GAAG,CAAGN,UAAU,EAAEO,IAAI,CAAC,CAAC,CAAC,CACtDnD,iBAAiB,CAAC,EAAE,CAAC,CACvB,CAAC,IAAM,CACLA,iBAAiB,CAAC4C,UAAU,CAAC,CAC/B,CACF,CAAC,CAEDN,WAAW,CAACc,OAAO,CAAIT,KAAK,EAAK,CAC/BvB,OAAO,CAACa,KAAK,CAAC,2BAA2B,CAAEU,KAAK,CAACV,KAAK,CAAC,CACvD7B,cAAc,CAAC,KAAK,CAAC,CACvB,CAAC,CAEDkC,WAAW,CAACe,KAAK,CAAG,IAAMjD,cAAc,CAAC,KAAK,CAAC,CAE/CkC,WAAW,CAACgB,KAAK,CAAC,CAAC,CACrB,CAAC,CAED,mBACEnE,IAAA,QACEoE,KAAK,CAAE,CACLC,UAAU,CAAE,SAAS,CACrBC,OAAO,CAAE,MAAM,CACfC,YAAY,CAAE,KAAK,CACnBC,SAAS,CAAE,2BAA2B,CACtCC,YAAY,CAAE,MAChB,CAAE,CAAAC,QAAA,cAEFxE,KAAA,QAAKkE,KAAK,CAAE,CAAEO,OAAO,CAAE,MAAM,CAAEC,UAAU,CAAE,UAAU,CAAEC,GAAG,CAAE,QAAS,CAAE,CAAAH,QAAA,eACrE1E,IAAA,aACE8E,KAAK,CAAEpE,OAAO,EAAIM,WAAW,CAAG,GAAG,CAAGJ,cAAc,CAAG,EAAE,CAAE,CAC3DmE,QAAQ,CAAGC,CAAC,EAAKrE,UAAU,CAACqE,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAC5CI,WAAW,CAAC,uBAAuB,CACnCC,IAAI,CAAC,GAAG,CACRC,IAAI,CAAC,IAAI,CACThB,KAAK,CAAE,CACLG,YAAY,CAAE,KAAK,CACnBc,MAAM,CAAE,gBAAgB,CACxBf,OAAO,CAAE,QAAQ,CACjBgB,QAAQ,CAAE,MAAM,CAChBC,MAAM,CAAE,UAAU,CAClBC,SAAS,CAAE,MACb,CAAE,CACH,CAAC,CACD,CAACrF,QAAQ,eACRH,IAAA,WACEyF,OAAO,CAAE1C,eAAgB,CACzBqB,KAAK,CAAE,CACLsB,KAAK,CAAE,MAAM,CACbC,MAAM,CAAE,MAAM,CACdtB,UAAU,CAAE,aAAa,CACzBgB,MAAM,CAAE,MAAM,CACdO,MAAM,CAAE,SAAS,CACjBjB,OAAO,CAAE,MAAM,CACfC,UAAU,CAAE,QAAQ,CACpBiB,cAAc,CAAE,QAClB,CAAE,CACF,aAAW,OAAO,CAClBC,KAAK,CAAC,OAAO,CAAApB,QAAA,cAEb1E,IAAA,QAAK+F,KAAK,CAAC,4BAA4B,CAACL,KAAK,CAAC,IAAI,CAACC,MAAM,CAAC,IAAI,CAACK,IAAI,CAAEhF,WAAW,CAAG,SAAS,CAAG,MAAO,CAACiF,OAAO,CAAC,WAAW,CAAAvB,QAAA,cACxH1E,IAAA,SAAMkG,CAAC,CAAC,8NAA8N,CAAC,CAAC,CACrO,CAAC,CACA,CACT,cACDlG,IAAA,WACEyF,OAAO,CAAE5D,YAAa,CACtBsE,QAAQ,CAAE,CAAC1F,OAAQ,CACnB2D,KAAK,CAAE,CACLgC,eAAe,CAAE,SAAS,CAC1BC,KAAK,CAAE,OAAO,CACdhB,MAAM,CAAE,MAAM,CACdd,YAAY,CAAE,KAAK,CACnBD,OAAO,CAAE,gBAAgB,CACzBgB,QAAQ,CAAE,SAAS,CACnBM,MAAM,CAAE,SACV,CAAE,CAAAlB,QAAA,CACH,aAED,CAAQ,CAAC,EACN,CAAC,CACH,CAAC,CAEV,CAAC,CAED,cAAe,CAAAnE,WAAW","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}